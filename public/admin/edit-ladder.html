<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Ladder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
	body {
	  background: linear-gradient(to right, #667eea, #764ba2);
	}
  </style>
</head>
<body class="min-h-screen text-gray-800">

  <div class="max-w-md mx-auto py-6 px-4">
	<h1 class="text-white text-2xl font-bold mb-6 text-center">Edit Ladder</h1>

	<form id="edit-ladder-form" class="bg-white rounded-xl shadow-md p-6 space-y-5">

	  <label class="block">
		<span class="text-sm text-gray-600">Ladder Name</span>
		<input id="ladder-name" type="text" class="mt-1 block w-full border rounded p-2" placeholder="2025 FC Ladder" />
	  </label>

	  <label class="block">
		<span class="text-sm text-gray-600">Description</span>
		<input id="description" type="text" class="mt-1 block w-full border rounded p-2" placeholder="Summer Open Challenge" />
	  </label>

	  <label class="block">
		<span class="text-sm text-gray-600">Ranking Formula</span>
		<select id="ranking-system" class="mt-1 block w-full border rounded p-2">
		  <option value="bump">Bump</option>
		  <option value="swap">Swap</option>
		  <option value="points">Points-Based</option>
		</select>
	  </label>

	  <label class="block">
		<span class="text-sm text-gray-600">Max Participants</span>
		<input id="max-players" type="number" class="mt-1 block w-full border rounded p-2" placeholder="e.g. 50" />
	  </label>

	  <div class="flex space-x-4">
		<label class="block flex-1">
		  <span class="text-sm text-gray-600">Start Date</span>
		  <input id="start-date" type="date" class="mt-1 block w-full border rounded p-2" value="" />
		</label>

		<label class="block flex-1">
		  <span class="text-sm text-gray-600">End Date</span>
		  <input id="end-date" type="date" class="mt-1 block w-full border rounded p-2" value="" />
		</label>
	  </div>

	  <label class="block">
		<span class="text-sm text-gray-600">Admin Name(s)</span>
		<input id="admin-names" type="text" class="mt-1 block w-full border rounded p-2" placeholder="Zach Cardais" />
	  </label>

	  <label class="block">
		<span class="text-sm text-gray-600">Admin Email(s)</span>
		<input id="admin-emails" type="email" class="mt-1 block w-full border rounded p-2" placeholder="zcardais@gmail.com" />
	  </label>

	  <label class="flex items-center space-x-3">
		<input id="allow-joining" type="checkbox" class="form-checkbox" />
		<span>Allow players to join from their dashboard</span>
	  </label>

	  <div class="pt-6">
		<button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl">
		  Save Changes
		</button>
	  </div>
	</form>
  </div>
  <!-- Bottom Navigation -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-6 py-3 z-50">
	<div class="flex justify-around">
	  <a href="index.html" class="flex flex-col items-center space-y-1 text-gray-400 hover:text-blue-600 transition">
		<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
			d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
		</svg>
		<span class="text-xs">Dashboard</span>
	  </a>
	  <a href="ladders.html" class="flex flex-col items-center space-y-1 text-blue-600">
		<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
		  <path
			d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
		</svg>
		<span class="text-xs font-medium">Ladders</span>
	  </a>
	  <a href="matches.html" class="flex flex-col items-center space-y-1 text-gray-400 hover:text-blue-600 transition">
		<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
			d="M9 17v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v8m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
		</svg>
		<span class="text-xs">Matches</span>
	  </a>
	  <a href="players.html" class="flex flex-col items-center space-y-1 text-gray-400 hover:text-blue-600 transition">
		<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
			d="M5.121 17.804A9.978 9.978 0 0112 15c2.21 0 4.243.715 5.879 1.922M15 10a3 3 0 11-6 0 3 3 0 016 0z"/>
		</svg>
		<span class="text-xs">Players</span>
	  </a>
	  <a href="settings.html" class="flex flex-col items-center space-y-1 text-gray-400 hover:text-blue-600 transition">
		<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
			d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
		</svg>
		<span class="text-xs">Settings</span>
	  </a>
	</div>
  </div>
  <script type="module">
    import { db } from "/src/js/firebase-setup.js";
    import { doc, getDoc, updateDoc } from "firebase/firestore";

    const urlParams = new URLSearchParams(window.location.search);
    const ladderId = urlParams.get("id");

    async function populateForm() {
      if (!ladderId) {
        alert("No ladder ID found in URL.");
        return;
      }

      try {
        const ladderRef = doc(db, "ladders", ladderId);
        const ladderSnap = await getDoc(ladderRef);

        if (!ladderSnap.exists()) {
          alert("Ladder not found.");
          return;
        }

        const data = ladderSnap.data();
        document.getElementById("ladder-name").value = data.name || "";
        document.getElementById("description").value = data.description || "";
        document.getElementById("ranking-system").value = data.rankingSystem || "bump";
        document.getElementById("max-players").value = data.maxPlayers || "";
        document.getElementById("start-date").value = data.startDate || "";
        document.getElementById("end-date").value = data.endDate || "";
        document.getElementById("admin-names").value = data.adminNames || "";
        document.getElementById("admin-emails").value = data.adminEmails || "";
        document.getElementById("allow-joining").checked = !!data.allowJoining;
      } catch (error) {
        console.error("Error fetching ladder data:", error);
        alert("Failed to load ladder. See console for details.");
      }
    }

    document.getElementById("edit-ladder-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const updatedData = {
        name: document.getElementById("ladder-name").value.trim(),
        description: document.getElementById("description").value.trim(),
        rankingSystem: document.getElementById("ranking-system").value,
        maxPlayers: parseInt(document.getElementById("max-players").value, 10),
        startDate: document.getElementById("start-date").value,
        endDate: document.getElementById("end-date").value,
        adminNames: document.getElementById("admin-names").value.trim(),
        adminEmails: document.getElementById("admin-emails").value.trim(),
        allowJoining: document.getElementById("allow-joining").checked
      };

      try {
        const ladderRef = doc(db, "ladders", ladderId);
        await updateDoc(ladderRef, updatedData);
        alert("Ladder updated successfully!");
        window.location.href = "ladders.html";
      } catch (err) {
        console.error("Failed to update ladder:", err);
        alert("Error updating ladder. See console for details.");
      }
    });

    populateForm();
  </script>
  <script type="module" src="/src/main.js"></script>

</body>
</html>